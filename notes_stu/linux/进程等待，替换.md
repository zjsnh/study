# 进程等待，替换

![image-20240726153018340](../c++_note/picture/image-20240726153018340.png)

## wait waitpid

![image-20240726153852731](../c++_note/picture/image-20240726153852731.png)

**等待成功返回子进程的pid**

![image-20240726154214060](../c++_note/picture/image-20240726154214060.png)

![image-20240726154253976](../c++_note/picture/image-20240726154253976.png)

![image-20240726154307383](../c++_note/picture/image-20240726154307383.png)

![image-20240726154317902](../c++_note/picture/image-20240726154317902.png)

**wait可以等待任意一个子进程退出，进行资源回收**

![image-20240726160007938](../c++_note/picture/image-20240726160007938.png)

![image-20240726160053647](../c++_note/picture/image-20240726160053647.png)

![image-20240726160124018](../c++_note/picture/image-20240726160124018.png)

如果子进程不退出，父进程就会一直等待子进程退出在 wait 

**阻塞等待**

![image-20240726160844854](../c++_note/picture/image-20240726160844854.png)

![image-20240726161007381](../c++_note/picture/image-20240726161007381.png)

## 拿到子进程的退出信息

![image-20240726172840652](../c++_note/picture/image-20240726172840652.png)

**ps ajx | head -1 && ps ajx | grep waittext | grep -v grep**



**通过waitpid wait 参数 int*  status 获得从子进程退出时的信息**

可以通过系统 strerror 获得相应的失败信息

### **status的构成**  

**但是为什么 status 按照整数输出，不是子程序exit（1）的 整数 1**

![image-20240726173921891](../c++_note/picture/image-20240726173921891.png)

![image-20240726173938457](../c++_note/picture/image-20240726173938457.png)

![image-20240726173959002](../c++_note/picture/image-20240726173959002.png)

因为 status并不是按照整数的使用，而是将int 的32位分成几部分

![image-20240726174103100](../c++_note/picture/image-20240726174103100.png)

数据从第二个 8  位开始存，前面都是0，也就是256

![image-20240726174345177](../c++_note/picture/image-20240726174345177.png)

程序通过与各部分进行比较，来获得完整的退出状态

![image-20240726174732933](../c++_note/picture/image-20240726174732933.png)

![image-20240728110543077](../c++_note/picture/image-20240728110543077.png)

**将status的各个部分分开，获取**

就算父进程运行到 wait 子进程还没结束，父进程就会一直等待子进程退出

![image-20240728110857701](../c++_note/picture/image-20240728110857701.png)

![image-20240728111607629](../c++_note/picture/image-20240728111607629.png)

**进程等待只能等自己定义的进程，等待不对就会等待失败**

![image-20240728111825717](../c++_note/picture/image-20240728111825717.png)

### 宏操作

获取status各部分的数据

![image-20240728112143203](../c++_note/picture/image-20240728112143203.png)

![image-20240728112347772](../c++_note/picture/image-20240728112347772.png)

![image-20240728112500617](../c++_note/picture/image-20240728112500617.png)

![image-20240728112840739](../c++_note/picture/image-20240728112840739.png)

**所有的进程只关心自己的子进程，孙子进程根本不关心**

### options

**父进程对子进程的等待方式**

![image-20240728113157884](../c++_note/picture/image-20240728113157884.png)

#### 阻塞：

 参数：0

**一直卡在wait，阻塞等待子进程退出**

#### 非阻塞轮询：

参数：WNOHANG

**非阻塞 循环，可以执行自己的事情**

![image-20240728114913492](../c++_note/picture/image-20240728114913492.png)

![image-20240728115003029](../c++_note/picture/image-20240728115003029.png)