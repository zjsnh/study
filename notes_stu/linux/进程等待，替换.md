# 进程等待，替换

![image-20240726153018340](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726153018340.png)

## wait waitpid

![image-20240726153852731](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726153852731.png)

**等待成功返回子进程的pid**

![image-20240726154214060](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726154214060.png)

![image-20240726154253976](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726154253976.png)

![image-20240726154307383](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726154307383.png)

![image-20240726154317902](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726154317902.png)

**wait可以等待任意一个子进程退出，进行资源回收**

![image-20240726160007938](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726160007938.png)

![image-20240726160053647](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726160053647.png)

![image-20240726160124018](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726160124018.png)

如果子进程不退出，父进程就会一直等待子进程退出在 wait 

**阻塞等待**

![image-20240726160844854](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726160844854.png)

![image-20240726161007381](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726161007381.png)

## 拿到子进程的退出信息

![image-20240726172840652](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726172840652.png)

**ps ajx | head -1 && ps ajx | grep waittext | grep -v grep**



**通过waitpid wait 参数 int*  status 获得从子进程退出时的信息**

可以通过系统 strerror 获得相应的失败信息

### **status的构成**  

**但是为什么 status 按照整数输出，不是子程序exit（1）的 整数 1**

![image-20240726173921891](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726173921891.png)

![image-20240726173938457](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726173938457.png)

![image-20240726173959002](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726173959002.png)

因为 status并不是按照整数的使用，而是将int 的32位分成几部分

![image-20240726174103100](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726174103100.png)

数据从第二个 8  位开始存，前面都是0，也就是256

![image-20240726174345177](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726174345177.png)

程序通过与各部分进行比较，来获得完整的退出状态

![image-20240726174732933](C:\Users\30780\AppData\Roaming\Typora\typora-user-images\image-20240726174732933.png)